<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Âä®Êº´ËßíËâ≤ËØÜÂà´</title>
  <link rel="icon" type="image/x-icon" href="./images/icon.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      padding: 20px;
      color: #333;
      margin: 0;
      overflow-x: hidden;
    }

    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap');

    .option-item label,
    .option-item select {
      font-family: 'Noto Sans SC', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    #background-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      transition: opacity 0.5s ease-in-out;
      opacity: 0;
    }
    
    .container {
      position: relative;
      z-index: 1;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      overflow: visible;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s forwards 0.3s;
    }
    
    @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes imageFadeIn {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }
    70% {
      opacity: 1;
      transform: scale(1.05);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  /* 3DÂç°ÁâáÂºπÂá∫Â±ÇÊ†∑Âºè */
  .popup-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    overflow: visible;
  }
  
  .popup-container.active {
    opacity: 1;
    visibility: visible;
  }
  
  .card-3d {
    perspective: 1500px;
    width: 70%;
    max-width: 600px;
    height: auto;
    position: relative;
    transform-style: preserve-3d;
    animation: cardPopIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform-origin: center;
    z-index: 2;
    margin-top: 50px;
  }
  
  .card-3d::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 20px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    transform: translateZ(-30px);
    z-index: -1;
  }
  
  .popup-image {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 20px;
      border: 5px solid white;
      box-shadow: 
        0 10px 25px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.1);
      transform: translateZ(20px);
      backface-visibility: hidden;
      position: relative;
      z-index: 3;
      object-fit: contain;
    }
  
  .reflection {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 20px;
    background: linear-gradient(135deg, 
      rgba(255, 255, 255, 0.1) 0%, 
      rgba(255, 255, 255, 0.3) 25%, 
      rgba(255, 255, 255, 0.6) 50%, 
      rgba(255, 255, 255, 0.1) 75%);
    pointer-events: none;
    z-index: 4;
    opacity: 0.6;
    mix-blend-mode: screen;
    transform: translateZ(0);
  }
  
  .highlight-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 20px;
    overflow: hidden;
    pointer-events: none;
    z-index: 5;
    transform: translateZ(0);
  }
  
  .moving-highlight {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
      rgba(255, 255, 255, 0.4) 0%, 
      rgba(255, 255, 255, 0.1) 30%, 
      transparent 70%);
    pointer-events: none;
    opacity: 0.6;
  }
  
  .face-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 6;
    border-radius: 20px;
  }
  
  .face-bounding-box {
    position: absolute;
    border: 3px solid #ff6b6b;
    border-radius: 8px;
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    background: transparent;
    animation: pulse 1.5s infinite;
  }
  
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7), 
                  0 0 0 2px rgba(255, 255, 255, 0.5),
                  inset 0 0 0 1px rgba(255, 255, 255, 0.1); }
    70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0), 
                   0 0 0 2px rgba(255, 255, 255, 0.5),
                   inset 0 0 0 1px rgba(255, 255, 255, 0.1); }
    100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0), 
                   0 0 0 2px rgba(255, 255, 255, 0.5),
                   inset 0 0 0 1px rgba(255, 255, 255, 0.1); }
  }
  
  @keyframes cardPopIn {
    0% {
      transform: scale(0.5) translateZ(0) rotateX(90deg);
      opacity: 0;
    }
    70% {
      transform: scale(1.05) translateZ(0) rotateX(0);
      opacity: 1;
    }
    100% {
      transform: scale(1) translateZ(0) rotateX(0);
      opacity: 1;
    }
  }

    header {
      background-color: rgba(255, 182, 193, 0.7); /* Ê®±Ëä±Ëâ≤ÂçäÈÄèÊòé */
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      color: white;
      font-size: 2.5em;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    h1 img {
            width: 32px;
            height: 32px;
            margin-right: 15px;
            vertical-align: middle;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
            transition: transform 0.3s ease;
        }
        
        h1 img:hover {
            transform: scale(1.1);
        }
    
    header p {
      color: white;
      margin: 10px 0 0 0;
      text-align: center;
      font-size: 1.1em;
    }

    .main-content {
      padding: 30px;
    }

    .upload-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      padding: 30px;
      border: 3px dashed #a777e3;
      border-radius: 10px;
      background: #f9f7ff;
      transition: all 0.3s ease;
    }
    
    #uploadArea {
      width: 100%;
    }
    
    #file-upload-tab,
    #url-upload-tab {
      width: 100%;
    }

    .upload-section:hover {
      background: #f0ebff;
      border-color: #5a4ae3;
    }

    .upload-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      cursor: pointer;
      border-radius: 8px;
      width: 100%;
      text-align: center;
    }

    .upload-icon {
      font-size: 60px;
      color: #a777e3;
      margin-bottom: 15px;
    }

    .upload-text {
      font-size: 1.2rem;
      color: #5a4ae3;
      margin-bottom: 15px;
    }

    .file-input {
      display: none;
    }

    .upload-btn {
      background: #6e8efb;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 15px;
    }

    .upload-btn:hover {
      background: #5a4ae3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(110, 142, 251, 0.4);
    }

    .options {
      display: flex;
      flex-direction: row;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin: -10px 0 10px 0;
      padding: 12px;
      background: linear-gradient(135deg, #fff5f8 0%, #f9f0f4 100%);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(255, 182, 193, 0.2);
      position: relative;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      width: 100%;
      max-width: 800px;
      border: none;
    }

    .options.show {
      opacity: 1;
      transform: translateY(0);
    }

    .options.show .option-item {
      animation: optionFadeIn 0.5s ease forwards;
    }

    .options.show .option-item:nth-child(1) {
      animation-delay: 0.1s;
    }

    .options.show .option-item:nth-child(2) {
      animation-delay: 0.2s;
    }

    @keyframes optionFadeIn {
      0% {
        opacity: 0;
        transform: translateY(10px) scale(0.95);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .option-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid #ffe6f0;
      flex: 1;
      min-width: 200px;
      position: relative;
      overflow: visible;
      z-index: 1;
    }

    .option-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 105, 180, 0.1), transparent);
      transition: left 0.5s ease;
      z-index: -1;
      pointer-events: none;
    }

    .option-item:hover {
      box-shadow: 0 8px 20px rgba(255, 140, 170, 0.4);
      transform: translateY(-4px) scale(1.02);
      border-color: #ff69b4;
    }

    .option-item:hover::before {
      left: 100%;
    }

    .option-item label,
    .option-item select {
      position: relative;
      z-index: 1;
    }

    .option-item label {
      font-weight: 600;
      color: #333;
      white-space: nowrap;
      font-size: 14px;
      min-width: 100px;
    }

    .option-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #ff69b4;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .option-item input[type="checkbox"]:hover {
      transform: scale(1.1);
    }

    .option-item select {
      flex: 1;
      padding: 10px 16px;
      border: 2px solid #ffe6f0;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      background-color: white;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23ff69b4" viewBox="0 0 16 16"><path d="M8 11L3 6h10l-5 5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 40px;
      position: relative;
      z-index: 1;
      opacity: 0;
      transform: scale(0.95) translateY(5px);
      border-color: transparent;
    }

    .options.show .option-item select {
      animation: selectOpen 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    .options.show .option-item:nth-child(1) select {
      animation-delay: 0.2s;
    }

    .options.show .option-item:nth-child(2) select {
      animation-delay: 0.3s;
    }

    @keyframes selectOpen {
      0% {
        opacity: 0;
        transform: scale(0.95) translateY(5px);
        border-color: transparent;
      }
      50% {
        transform: scale(1.02) translateY(-2px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
        border-color: #ffe6f0;
      }
    }

    .option-item select:focus {
      outline: none;
      border-color: #ff69b4;
      box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.2);
      background-color: white;
      transform: translateX(0);
      animation: none;
      opacity: 1;
      border-color: #ff69b4;
    }

    .option-item select:hover {
      border-color: #ff69b4;
      background-color: #fff9fc;
      transform: translateX(2px);
    }

    .option-item select:focus {
      outline: none;
      border-color: #ff69b4;
      box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.2);
      background-color: white;
      transform: translateX(0);
    }

    /* Ëá™ÂÆö‰πâ‰∏ãÊãâËèúÂçïÊ†∑Âºè */
    .custom-select {
      position: relative;
      flex: 1;
      min-width: 150px;
    }

    .custom-select-selected {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      border: 2px solid #ffe6f0;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      background-color: white;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      z-index: 2000;
    }

    .custom-select-selected:hover {
      border-color: #ff69b4;
      background-color: #fff9fc;
      transform: translateX(2px);
    }

    .custom-select-selected:focus {
      outline: none;
      border-color: #ff69b4;
      box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.2);
      background-color: white;
      transform: translateX(0);
    }

    .custom-select-arrow {
      font-size: 12px;
      color: #ff69b4;
      transition: transform 0.3s ease;
    }

    .custom-select-selected.open .custom-select-arrow {
      transform: rotate(180deg);
    }

    .custom-select-options {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      border: 2px solid #ffe6f0;
      border-radius: 0 0 8px 8px;
      background-color: white;
      box-shadow: 0 6px 16px rgba(255, 140, 170, 0.3);
      z-index: 1999;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .custom-select-options.open {
      max-height: 200px;
      margin-top: 2px;
    }

    .custom-select-option {
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      background-color: white;
      color: #333;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      transform: translateY(5px);
    }

    .custom-select-options.open .custom-select-option {
      animation: optionSlideIn 0.3s ease forwards;
    }

    .custom-select-options.open .custom-select-option:nth-child(1) {
      animation-delay: 0.05s;
    }

    .custom-select-options.open .custom-select-option:nth-child(2) {
      animation-delay: 0.1s;
    }

    .custom-select-options.open .custom-select-option:nth-child(3) {
      animation-delay: 0.15s;
    }

    .custom-select-options.open .custom-select-option:nth-child(4) {
      animation-delay: 0.2s;
    }

    .custom-select-option:hover {
      background-color: #ffe6f0;
      transform: translateX(5px);
    }

    .custom-select-option.selected {
      background-color: #ff69b4;
      color: white;
    }

    @keyframes optionSlideIn {
      0% {
        opacity: 0;
        transform: translateY(5px) scale(0.95);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* ÈöêËóèÂÖ®Â±Ä‰øÆÊ≠£ÈÄâÈ°π */
     .option-item #useCorrection,
     .option-item label[for="useCorrection"] {
       display: none;
     }

    /* ÈÄöÁü•ÁªÑ‰ª∂Ê†∑Âºè */
    .notification {
      position: fixed;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 11000;
      background: linear-gradient(135deg, #ff69b4, #ff85c0);
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(255, 105, 180, 0.4);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      min-width: 300px;
      max-width: 90%;
      pointer-events: auto;
      /* Á°Æ‰øùÂõ∫ÂÆö‰ΩçÁΩÆ‰∏çÂèóÂÖ∂‰ªñÊ†∑ÂºèÂΩ±Âìç */
      margin: 0;
      padding: 16px 24px;
    }

    .notification.show {
      top: 150px;
    }

    .notification-content {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .notification-icon {
      font-size: 20px;
    }

    .notification-text {
      font-weight: 500;
      font-size: 14px;
    }

    /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
    @media (max-width: 768px) {
      .options {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
        padding: 15px;
      }
      
      .option-item {
        justify-content: space-between;
        flex: 1;
        min-width: auto;
      }
      
      .notification {
        min-width: 250px;
        padding: 12px 20px;
      }
    }

    .selected-image-container {
      position: relative;
      display: inline-block;
      border: none;
      border-radius: 10px;
      padding: 20px;
      background-color: #f9f7ff;
      transition: all 0.3s ease;
    }
    
    .selected-image-container:hover {
      border-color: #8a2be2;
      background-color: #e6d7ff;
    }
    
    .selected-image {
      max-width: 100%;
      max-height: 500px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      object-fit: contain;
    }
    
    .change-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #8a2be2;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    
    .change-btn:hover {
      background-color: #7a1bd2;
    }
    
    .preview-container {
      margin-top: 20px;
      text-align: center;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s forwards 0.3s;
    }

    .preview-image {
      max-width: 100%;
      max-height: 300px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      display: none;
      object-fit: contain;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #6e8efb;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .result-section {
      display: none;
      margin-top: 30px;
    }

    .result-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      justify-content: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .result-card {
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 
        0 6px 16px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 0 0 0 1px rgba(255, 255, 255, 0.3);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      z-index: 1;
      transform-style: preserve-3d;
      perspective: 1000px;
      cursor: pointer;
    }
    
    .result-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 15px;
      background: linear-gradient(120deg, 
        rgba(255, 255, 255, 0) 0%, 
        rgba(255, 255, 255, 0.4) 50%, 
        rgba(255, 255, 255, 0) 100%);
      z-index: -1;
      transition: all 0.3s ease;
      opacity: 0;
    }
    
    .result-card:hover::before {
      opacity: 1;
    }

    .result-card:hover {
      transform: translateY(-8px) scale(1.05);
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.2),
        inset 0 0 0 1px rgba(255, 255, 255, 0.5);
    }
    
    .result-card:active {
      transform: translateY(-5px) scale(0.98);
    }
    
    .result-top {
      background: linear-gradient(90deg, #6e8efb, #a777e3);
      padding: 15px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .result-icon {
      font-size: 2rem;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
      100% { transform: translateY(0px); }
    }

    .result-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .result-info {
      padding: 15px;
    }

    .result-name {
      font-size: 1.3rem;
      font-weight: bold;
      color: #5a4ae3;
      margin-bottom: 8px;
      transition: all 0.3s ease;
      display: inline-block;
      position: relative;
      cursor: pointer;
    }
    
    .result-name:hover {
      color: #ff6b6b;
      transform: translateY(-2px) scale(1.05);
      text-shadow: 0 2px 4px rgba(255, 107, 107, 0.3);
    }
    
    .result-name::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: #ff6b6b;
      transition: width 0.3s ease;
    }
    
    .result-name:hover::after {
      width: 100%;
    }

    .result-anime {
      font-size: 1rem;
      color: #666;
      margin-bottom: 8px;
      transition: all 0.3s ease;
      display: inline-block;
      position: relative;
      cursor: pointer;
    }
    
    .candidate-anime {
      font-size: 0.9rem;
      color: #777;
      margin: 5px 0;
      transition: all 0.3s ease;
      display: inline-block;
      position: relative;
      cursor: pointer;
    }
    
    .result-anime:hover,
    .candidate-anime:hover {
      color: #5a4ae3;
      transform: translateY(-2px) scale(1.05);
      text-shadow: 0 2px 4px rgba(90, 74, 227, 0.3);
    }
    
    .search-buttons {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 10px;
      margin: 10px 0 15px 0;
      flex-wrap: wrap;
    }
    
    .search-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .bangumi-btn {
      background: linear-gradient(90deg, #e74c3c, #c0392b);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .search-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }
    
    .search-btn:active {
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
    }
    
    .result-anime::after,
    .candidate-anime::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: #5a4ae3;
      transition: width 0.3s ease;
    }
    
    .result-anime:hover::after,
    .candidate-anime:hover::after {
      width: 100%;
    }

    .result-score {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 8px;
    }
    
    .confidence-bar-container {
      margin-bottom: 10px;
    }
    
    .confidence-bar {
      width: 100%;
      height: 8px;
      background-color: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    
    .confidence-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      border-radius: 4px;
      width: 0;
      transition: width 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
      position: relative;
      animation: fillBar 1s ease-out forwards;
    }
    
    .confidence-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.2) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0.2) 75%,
        transparent 75%
      );
      background-size: 20px 20px;
      animation: progressAnimation 1s linear infinite;
      border-radius: 4px;
    }
    
    @keyframes fillBar {
      from {
        width: 0;
      }
      to {
        width: var(--confidence-percent);
      }
    }
    
    @keyframes progressAnimation {
      0% {
        background-position: 0 0;
      }
      100% {
        background-position: 20px 20px;
      }
    }

    .result-details {
      font-size: 0.9rem;
      color: #999;
    }
    
    .result-details-toggle {
      margin-top: 10px;
      text-align: center;
    }
    
    .toggle-btn {
      background: linear-gradient(90deg, #6e8efb, #a777e3);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 5px 15px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }
    
    .toggle-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .result-details-hidden {
      margin-top: 10px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 8px;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: max-height 0.5s ease, opacity 0.5s ease, padding 0.5s ease;
    }
    
    .result-details-hidden.expanded {
      max-height: 800px;
      opacity: 1;
      padding: 15px;
    }
    
    .candidate-results {
      margin-top: 10px;
    }
    
    .candidate-item {
      display: flex;
      flex-direction: column;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }
    
    .candidate-item:last-child {
      border-bottom: none;
    }
    
    .candidate-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .candidate-score {
      font-weight: 500;
      color: #666;
      min-width: 120px;
    }
    
    .candidate-name {
      font-weight: bold;
      color: #5a4ae3;
    }
    
    .candidate-score {
      color: #666;
    }

    .error-message {
      display: none;
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }

    /* ‰∏ä‰º†Ê†áÁ≠æÈ°µÊ†∑Âºè */
    .upload-tabs {
      display: flex;
      margin-bottom: 20px;
      border-radius: 12px;
      overflow: hidden;
      background: #f8f9fa;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    .tab-slider {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 50%;
      background: linear-gradient(135deg, #ff69b4, #ff85c0);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(255, 105, 180, 0.3);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 0;
    }

    .tab-btn {
      padding: 12px 24px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      flex: 1;
      text-align: center;
      z-index: 1;
    }

    .tab-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255, 105, 180, 0.1), rgba(255, 133, 192, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .tab-btn:hover {
      color: #ff69b4;
      background: rgba(255, 105, 180, 0.05);
    }

    .tab-btn:hover::before {
      opacity: 1;
    }

    .tab-btn.active {
      color: white;
      background: transparent;
      box-shadow: none;
      transform: translateY(-1px);
    }

    .tab-btn.active::before {
      opacity: 0;
    }

    .tab-btn span {
      position: relative;
      z-index: 1;
    }

    .tab-btn.active span {
      animation: tabPulse 1s ease-in-out;
    }

    @keyframes tabPulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }

    .upload-tab {
      display: none;
    }

    .upload-tab.active {
      display: block;
    }

    /* URLËæìÂÖ•Âå∫ÂüüÊ†∑Âºè */
    .url-input-container {
      display: flex;
      margin: 20px 0;
    }

    .url-input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px 0 0 4px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s ease;
    }

    .url-input:focus {
      border-color: #5a4ae3;
    }

    .url-submit-btn {
      padding: 0 20px;
      background: linear-gradient(135deg, #5a4ae3, #8b5cf6);
      color: white;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: background 0.3s ease;
    }

    .url-submit-btn:hover {
      background: linear-gradient(135deg, #4c3db2, #7c3aed);
    }

    .url-hint {
      color: #666;
      font-size: 12px;
      text-align: center;
      margin-top: 10px;
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 20px;
      }
      
      header h1 {
        font-size: 1.8rem;
      }
      
      .result-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body>
  <div id="background-container"></div>
  <div class="container">
    <header>
      <h1><img src="./images/icon.png" alt="Âä®Êº´ÂõæÊ†á" style="vertical-align: middle; margin-right: 10px; width: 32px; height: 32px;">Âä®Êº´ËßíËâ≤ËØÜÂà´</h1>
      <p>‰∏ä‰º†ÂõæÁâáÔºåËØÜÂà´ÂÖ∂‰∏≠ÁöÑÂä®Êº´ËßíËâ≤</p>
    </header>
    
    <!-- 3DÂç°ÁâáÂºπÂá∫Â±Ç -->
    <div id="popup-container" class="popup-container">
      <div class="card-3d">
        <img id="popupImage" src="" alt="Preview" class="popup-image">
        <div class="reflection"></div>
        <div class="highlight-overlay">
          <div class="moving-highlight"></div>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="upload-section">
        <div id="uploadArea">
          <div class="upload-tabs">
            <div class="tab-slider"></div>
            <button class="tab-btn active" onclick="switchUploadTab('file')"><span>Êú¨Âú∞‰∏ä‰º†</span></button>
            <button class="tab-btn" onclick="switchUploadTab('url')"><span>URLÈìæÊé•</span></button>
          </div>
          
          <div id="url-upload-tab" class="upload-tab">
            <div class="url-input-container">
              <input type="text" id="imageUrl" class="url-input" placeholder="ËØ∑ËæìÂÖ•ÂõæÁâáURLÂú∞ÂùÄ">
              <button class="url-submit-btn" onclick="uploadImageByUrl()">ËØÜÂà´</button>
            </div>
            <p class="url-hint">ÊîØÊåÅ HTTP/HTTPS ÂçèËÆÆÁöÑÂõæÁâáÈìæÊé•</p>
          </div>
        </div>
        
        <div class="options">
          <div class="option-item">
            <label for="model">ËØÜÂà´Ê®°ÂûãÔºö</label>
            <!-- Ëá™ÂÆö‰πâ‰∏ãÊãâËèúÂçï -->
            <div class="custom-select">
              <div class="custom-select-selected" onclick="toggleCustomSelect('model')">
                <span id="model-selected">ÈªòËÆ§Ê®°Âûã</span>
                <span class="custom-select-arrow">‚ñº</span>
              </div>
              <div class="custom-select-options" id="model-options">
                <div class="custom-select-option" data-value="" onclick="selectOption('model', '', 'ÈªòËÆ§Ê®°Âûã')">ÈªòËÆ§Ê®°Âûã</div>
                <div class="custom-select-option" data-value="pre_stable" onclick="selectOption('model', 'pre_stable', 'È´òÁ∫ßÂä®ÁîªËØÜÂà´Ê®°Âûã2')">È´òÁ∫ßÂä®ÁîªËØÜÂà´Ê®°Âûã2</div>
                <div class="custom-select-option" data-value="anime" onclick="selectOption('model', 'anime', 'ÊôÆÈÄöÂä®ÁîªËØÜÂà´Ê®°Âûã')">ÊôÆÈÄöÂä®ÁîªËØÜÂà´Ê®°Âûã</div>
                <div class="custom-select-option" data-value="animetrace_high_beta" onclick="selectOption('model', 'animetrace_high_beta', 'ÊµãËØïÁâàÊúÄÈ´òË¥®ÈáèÊ®°Âûã')">ÊµãËØïÁâàÊúÄÈ´òË¥®ÈáèÊ®°Âûã</div>
              </div>
              <!-- ÈöêËóèÁöÑÂéüÁîüselectÂÖÉÁ¥† -->
              <select id="model" style="display: none;">
                <option value="">ÈªòËÆ§Ê®°Âûã</option>
                <option value="pre_stable">È´òÁ∫ßÂä®ÁîªËØÜÂà´Ê®°Âûã2</option>
                <option value="anime">ÊôÆÈÄöÂä®ÁîªËØÜÂà´Ê®°Âûã</option>
                <option value="animetrace_high_beta">ÊµãËØïÁâàÊúÄÈ´òË¥®ÈáèÊ®°Âûã</option>
              </select>
            </div>
          </div>
          <div class="option-item">
            <label for="aiDetect">AIÊ£ÄÊµãÔºö</label>
            <!-- Ëá™ÂÆö‰πâ‰∏ãÊãâËèúÂçï -->
            <div class="custom-select">
              <div class="custom-select-selected" onclick="toggleCustomSelect('aiDetect')">
                <span id="aiDetect-selected">ÈªòËÆ§</span>
                <span class="custom-select-arrow">‚ñº</span>
              </div>
              <div class="custom-select-options" id="aiDetect-options">
                <div class="custom-select-option" data-value="" onclick="selectOption('aiDetect', '', 'ÈªòËÆ§')">ÈªòËÆ§</div>
                <div class="custom-select-option" data-value="1" onclick="selectOption('aiDetect', '1', 'ÂºÄÂêØ')">ÂºÄÂêØ</div>
                <div class="custom-select-option" data-value="2" onclick="selectOption('aiDetect', '2', 'ÂÖ≥Èó≠')">ÂÖ≥Èó≠</div>
              </div>
              <!-- ÈöêËóèÁöÑÂéüÁîüselectÂÖÉÁ¥† -->
              <select id="aiDetect" style="display: none;">
                <option value="">ÈªòËÆ§</option>
                <option value="1">ÂºÄÂêØ</option>
                <option value="2">ÂÖ≥Èó≠</option>
              </select>
            </div>
          </div>
        </div>
        
        <div id="file-upload-tab" class="upload-tab active">
          <label class="upload-label" for="imageUpload">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">ÁÇπÂáªÈÄâÊã©ÂõæÁâáÊàñÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ</div>
            <p>ÊîØÊåÅ JPG, PNG, GIF Ê†ºÂºèÔºåÊúÄÂ§ßÊîØÊåÅ 5MB</p>
          </label>
          <input type="file" id="imageUpload" class="file-input" accept="image/*" onchange="previewImage(event)">
        </div>
        
        <div id="selectedImageArea" class="selected-image-container" style="display: none;" onclick="changeImage()">
            <img id="selectedImagePreview" class="selected-image" src="" alt="Selected Image">
            <div id="face-overlay" class="face-overlay"></div>
          </div>
      </div>
      
      <script>
         // Êõ¥Êç¢ÂõæÁâáÂäüËÉΩ - ÁÇπÂáªÂõæÁâáÊõ¥Êç¢
         function changeImage() {
           document.getElementById('selectedImageArea').style.display = 'none';
           document.getElementById('uploadArea').style.display = 'block';
           // ÊòæÁ§∫ÈÄâÈ°πÊ†è
           const optionsContainer = document.querySelector('.options');
           if (optionsContainer) {
             optionsContainer.classList.add('show');
           }
           // Ê∏ÖÁ©∫Êñá‰ª∂ËæìÂÖ•Ê°Ü
           document.getElementById('imageUpload').value = '';
         }
         
         // ÂàáÊç¢‰∏ä‰º†Ê†áÁ≠æÈ°µ
         function switchUploadTab(tab) {
           // ÂàáÊç¢Ê†áÁ≠æÊåâÈíÆÁä∂ÊÄÅ
           document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
           
           // ÁßªÂä®ÊªëÂùó
           const slider = document.querySelector('.tab-slider');
           if (slider) {
             if (tab === 'file') {
               slider.style.transform = 'translateX(0)';
             } else if (tab === 'url') {
               slider.style.transform = 'translateX(100%)';
             }
           }
           
           // ÂàáÊç¢Ê†áÁ≠æÂÜÖÂÆπ
           document.querySelectorAll('.upload-tab').forEach(tabContent => tabContent.classList.remove('active'));
           document.getElementById(tab + '-upload-tab').classList.add('active');
           
           // ÊéßÂà∂uploadAreaÁöÑÊòæÁ§∫/ÈöêËóè
           const uploadArea = document.getElementById('uploadArea');
           if (tab === 'url') {
             uploadArea.style.display = 'block';
           } else {
             uploadArea.style.display = 'block';
           }
         }
         
         // ÈÄöËøáURL‰∏ä‰º†ÂõæÁâá
        window.uploadImageByUrl = function() {
          const imageUrl = document.getElementById('imageUrl').value.trim();
          const model = document.getElementById('model');
          const aiDetect = document.getElementById('aiDetect');
           
           if (!imageUrl) {
             showError('ËØ∑ËæìÂÖ•ÂõæÁâáURLÂú∞ÂùÄ');
             return;
           }
           
           // È™åËØÅURLÊ†ºÂºè
           try {
             new URL(imageUrl);
           } catch (error) {
             showError('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂõæÁâáURLÂú∞ÂùÄ');
             return;
           }
           
           // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
           showLoading();
           
           // ÂáÜÂ§áË°®ÂçïÊï∞ÊçÆ
          const formData = new FormData();
          formData.append('url', imageUrl);
          formData.append('is_multi', '1'); // ÈªòËÆ§ÂºÄÂêØÊòæÁ§∫Â§ö‰∏™ÁªìÊûú
          if (model.value) {
            formData.append('model', model.value);
          }
          if (aiDetect.value) {
            formData.append('ai_detect', aiDetect.value);
          }
           
           // ÂèëÈÄÅËØ∑Ê±ÇÂà∞ÂêéÁ´ØAPI
           fetch('/api/recognize', {
             method: 'POST',
             body: formData
           })
           .then(response => response.json())
           .then(data => {
             hideLoading();
             if (data.error) {
               showError(data.error);
             } else {
               displayResults(data);
               
               // ÊòæÁ§∫ÂõæÁâáÈ¢ÑËßà
               document.getElementById('selectedImageArea').style.display = 'block';
               document.getElementById('uploadArea').style.display = 'none';
               document.getElementById('selectedImagePreview').src = imageUrl;
               // ÈöêËóèÈÄâÈ°πÊ†è
               const optionsContainer = document.querySelector('.options');
               if (optionsContainer) {
                 optionsContainer.classList.remove('show');
               }
             }
           })
           .catch(error => {
             hideLoading();
             showError('ËØÜÂà´Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
             console.error('Error:', error);
           });
         }
       </script>

      <div class="preview-container">
        <img id="previewImage" class="preview-image" alt="ÂõæÁâáÈ¢ÑËßà">
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Ê≠£Âú®ËØÜÂà´‰∏≠ÔºåËØ∑Á®çÂÄô...</p>
      </div>

      <div class="error-message" id="errorMessage"></div>

      <!-- ÈÄöÁü•ÁªÑ‰ª∂ -->
      <div class="notification" id="notification">
        <div class="notification-content">
          <div class="notification-icon">‚úÖ</div>
          <div class="notification-text"></div>
        </div>
      </div>

      <div class="result-section" id="resultSection">
        <div class="result-header">
          <h2>ËØÜÂà´ÁªìÊûú</h2>
        </div>
        <div class="result-grid" id="resultGrid"></div>
      </div>
    </div>
  </div>

  <script>
    // ËÉåÊôØËΩÆÊí≠ÂäüËÉΩ
  const backgroundImages = [
    './images/background1.jpg',
    './images/background2.jpg',
    './images/background3.jpg',
    './images/background4.jpg',
    './images/background5.jpg',
    './images/background6.jpg',
    './images/background7.jpg',
    './images/background8.jpg',
    './images/background9.jpg'
  ];
  let currentBackgroundIndex = 0;

  function loadBackgroundImage(index) {
    const img = new Image();
    img.onload = function() {
      document.getElementById('background-container').style.backgroundImage = `url(${this.src})`;
      document.getElementById('background-container').style.opacity = '1';
    };
    img.onerror = function() {
      console.error(`Failed to load background image: ${this.src}`);
    };
    img.src = backgroundImages[index];
  }

  function changeBackground() {
    document.getElementById('background-container').style.opacity = '0';
    setTimeout(() => {
      // ÈöèÊú∫ÈÄâÊã©‰∏ã‰∏ÄÂº†ÂõæÁâáÔºåÁ°Æ‰øù‰∏ç‰∏éÂΩìÂâçÂõæÁâáÈáçÂ§ç
      let newBackgroundIndex;
      do {
        newBackgroundIndex = Math.floor(Math.random() * backgroundImages.length);
      } while (newBackgroundIndex === currentBackgroundIndex && backgroundImages.length > 1);
      
      currentBackgroundIndex = newBackgroundIndex;
      loadBackgroundImage(currentBackgroundIndex);
    }, 500); // Á≠âÂæÖ0.5Áßí‰ª•ÂÆåÊàêÊ∑°Âá∫ÊïàÊûú
  }

  // ÊØè10ÁßíÂàáÊç¢‰∏ÄÊ¨°ËÉåÊôØ
  setInterval(changeBackground, 10000);

  // È°µÈù¢Âä†ËΩΩÊó∂ÊòæÁ§∫ÈöèÊú∫ËÉåÊôØ
  window.onload = function() {
      currentBackgroundIndex = Math.floor(Math.random() * backgroundImages.length);
      loadBackgroundImage(currentBackgroundIndex);
      
      // Ëá™Âä®ÊòæÁ§∫ÈÄâÈ°πÊ†èÂπ∂Ê∑ªÂä†Âä®ÁîªÊïàÊûú
      setTimeout(function() {
        const optionsContainer = document.querySelector('.options');
        if (optionsContainer) {
          optionsContainer.classList.add('show');
        }
      }, 500);
    };

    document.addEventListener('DOMContentLoaded', function() {
      const imageUpload = document.getElementById('imageUpload');
      const previewImage = document.getElementById('previewImage');
      const loading = document.getElementById('loading');
      const errorMessage = document.getElementById('errorMessage');
      const resultSection = document.getElementById('resultSection');
      const resultGrid = document.getElementById('resultGrid');
      const uploadLabel = document.querySelector('.upload-label');
      
      // ‰∏∫Ëá™ÂÆö‰πâ‰∏ãÊãâËèúÂçïÊ∑ªÂä†Èº†Ê†áÊÇ¨ÂÅúËá™Âä®ÊâìÂºÄÂäüËÉΩ
      const customSelects = document.querySelectorAll('.custom-select-selected');
      customSelects.forEach(function(select) {
        // Ê∑ªÂä†mouseenter‰∫ã‰ª∂ÁõëÂê¨Âô®
        select.addEventListener('mouseenter', function() {
          // Ëá™Âä®ÊâìÂºÄ‰∏ãÊãâËèúÂçï
          this.classList.add('open');
          const options = this.nextElementSibling;
          if (options && options.classList.contains('custom-select-options')) {
            options.classList.add('open');
          }
        });
        
        // Ê∑ªÂä†mouseleave‰∫ã‰ª∂ÁõëÂê¨Âô®
        select.addEventListener('mouseleave', function(e) {
          // Âª∂ËøüÂÖ≥Èó≠ÔºåËÆ©Áî®Êà∑ÊúâÊó∂Èó¥ÁßªÂä®Âà∞ÈÄâÈ°π‰∏ä
          setTimeout(() => {
            // Ê£ÄÊü•Èº†Ê†áÊòØÂê¶Âú®ÈÄâÈ°π‰∏ä
            const options = this.nextElementSibling;
            const isMouseOverOptions = options && options.matches(':hover');
            
            // Âè™ÊúâÂΩìÈº†Ê†á‰∏çÂú®ÈÄâÈ°π‰∏äÊó∂ÊâçÂÖ≥Èó≠
            if (!isMouseOverOptions) {
              this.classList.remove('open');
              if (options && options.classList.contains('custom-select-options')) {
                options.classList.remove('open');
              }
            }
          }, 300); // Â¢ûÂä†Âª∂ËøüÊó∂Èó¥ÔºåÁªôÁî®Êà∑Êõ¥Â§öÊó∂Èó¥ÁßªÂä®Èº†Ê†áÂà∞ÈÄâÈ°π‰∏ä
        });
      });
      
      // ‰∏∫ÈÄâÈ°πÊ∑ªÂä†mouseenter‰∫ã‰ª∂ÁõëÂê¨Âô®
      const optionElements = document.querySelectorAll('.custom-select-option');
      optionElements.forEach(function(option) {
        option.addEventListener('mouseenter', function() {
          // Á°Æ‰øùÁà∂Á∫ßÈÄâÈ°πÂÆπÂô®‰øùÊåÅÊâìÂºÄÁä∂ÊÄÅ
          const optionsContainer = this.parentElement;
          const selectedElement = optionsContainer.previousElementSibling;
          if (optionsContainer && selectedElement) {
            optionsContainer.classList.add('open');
            selectedElement.classList.add('open');
          }
        });
        
        option.addEventListener('mouseleave', function(e) {
          // Âª∂ËøüÂÖ≥Èó≠ÔºåËÆ©Áî®Êà∑ÊúâÊó∂Èó¥ÁßªÂä®ÂõûÈÄâÊã©Ê°Ü
          setTimeout(() => {
            const optionsContainer = this.parentElement;
            const selectedElement = optionsContainer.previousElementSibling;
            const isMouseOverSelect = selectedElement && selectedElement.matches(':hover');
            const isMouseOverOptions = optionsContainer && optionsContainer.matches(':hover');
            
            // Âè™ÊúâÂΩìÈº†Ê†áÊó¢‰∏çÂú®ÈÄâÊã©Ê°Ü‰∏ä‰πü‰∏çÂú®ÈÄâÈ°πÂÆπÂô®‰∏äÊó∂ÊâçÂÖ≥Èó≠
            if (!isMouseOverSelect && !isMouseOverOptions) {
              optionsContainer.classList.remove('open');
              selectedElement.classList.remove('open');
            }
          }, 300); // Â¢ûÂä†Âª∂ËøüÊó∂Èó¥ÔºåÁªôÁî®Êà∑Êõ¥Â§öÊó∂Èó¥ÁßªÂä®Èº†Ê†á
        });
      });
      
      // ÁßªÈô§upload-sectionÁöÑmouseenter‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºåÁ°Æ‰øù‰∏ãÊãâËèúÂçïËÉΩËá™Âä®Êî∂Âõû
      
      // ÂàáÊç¢Ëá™ÂÆö‰πâ‰∏ãÊãâËèúÂçïÁöÑÊòæÁ§∫/ÈöêËóè
      window.toggleCustomSelect = function(id) {
        const selectedElement = document.querySelector(`#${id}-selected`).parentElement;
        const optionsContainer = document.getElementById(`${id}-options`);
        
        if (selectedElement && optionsContainer) {
          selectedElement.classList.toggle('open');
          optionsContainer.classList.toggle('open');
        }
      };
      
      // ÈÄâÊã©Ëá™ÂÆö‰πâ‰∏ãÊãâËèúÂçïÁöÑÈÄâÈ°π
      window.selectOption = function(id, value, text) {
        // Êõ¥Êñ∞ÊòæÁ§∫ÁöÑÊñáÊú¨
        const selectedElement = document.getElementById(`${id}-selected`);
        if (selectedElement) {
          selectedElement.textContent = text;
        }
        
        // Êõ¥Êñ∞ÈöêËóèÁöÑÂéüÁîüselectÂÖÉÁ¥†ÁöÑÂÄº
        const hiddenSelect = document.getElementById(id);
        if (hiddenSelect) {
          hiddenSelect.value = value;
        }
        
        // ÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
        const selectedContainer = document.querySelector(`#${id}-selected`).parentElement;
        const optionsContainer = document.getElementById(`${id}-options`);
        if (selectedContainer && optionsContainer) {
          selectedContainer.classList.remove('open');
          optionsContainer.classList.remove('open');
        }
      };

      // ‰øùÂ≠òÂΩìÂâçÊòæÁ§∫ÁöÑÂõæÁâá
      let currentImageSrc = '';
      
      // ‰∏ä‰º†ÂõæÁâáÂáΩÊï∞
      function uploadImage() {
        // Ëé∑ÂèñÂΩìÂâçÈÄâÊã©ÁöÑÂõæÁâáÊñá‰ª∂
        const imageUpload = document.getElementById('imageUpload');
        const file = imageUpload.files[0];
        const model = document.getElementById('model');
        const aiDetect = document.getElementById('aiDetect');
        
        if (file) {
          // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞è
          if (file.size > 5 * 1024 * 1024) { // 5MB
            showError('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá5MB');
            return;
          }

          // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
          showLoading();

          // ÂáÜÂ§áË°®ÂçïÊï∞ÊçÆ
          const formData = new FormData();
          formData.append('file', file);
          formData.append('is_multi', '1'); // ÈªòËÆ§ÂºÄÂêØÊòæÁ§∫Â§ö‰∏™ÁªìÊûú
          if (model.value) {
            formData.append('model', model.value);
          }
          if (aiDetect.value) {
            formData.append('ai_detect', aiDetect.value);
          }

          // ÂèëÈÄÅËØ∑Ê±ÇÂà∞ÂêéÁ´ØAPI
          fetch('/api/recognize', {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            hideLoading();
            if (data.error) {
              showError(data.error);
            } else {
              displayResults(data);
            }
          })
          .catch(error => {
            hideLoading();
            showError('ËØÜÂà´Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            console.error('Error:', error);
          });
        } else {
          showError('ËØ∑ÂÖàÈÄâÊã©‰∏ÄÂº†ÂõæÁâá');
        }
      }
      
      // ÂõæÁâáÈ¢ÑËßàÂäüËÉΩ - Áé∞Âú®Êîπ‰∏∫3DÂç°ÁâáÂºπÂá∫ÊïàÊûú
      imageUpload.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            // ‰øùÂ≠òÂΩìÂâçÂõæÁâáË∑ØÂæÑ
            currentImageSrc = event.target.result;
            
            const popupImage = document.getElementById('popupImage');
            const popupContainer = document.getElementById('popup-container');
            
            // ËÆæÁΩÆÂºπÂá∫ÂõæÁâáÁöÑÊ∫ê
            popupImage.src = event.target.result;
            
            // ÈáçÁΩÆÂä®ÁîªÁ±ª
            const card3d = document.querySelector('.card-3d');
            card3d.classList.remove('active');
            
            // Ëß¶ÂèëÈáçÊéí
            void card3d.offsetWidth;
            
            // ÊòæÁ§∫ÂºπÂá∫Â±Ç
             setTimeout(() => {
              popupContainer.classList.add('active');
              
              // Ëá™Âä®‰∏ä‰º†ÂõæÁâá
              uploadImage();
              
              // ÈöêËóèÈÄâÈ°πÊ†è
              const optionsContainer = document.querySelector('.options');
              if (optionsContainer) {
                optionsContainer.classList.remove('show');
              }
            }, 10);
          }
          reader.readAsDataURL(file);
        }
      });

      // ÊãñÊãΩ‰∏ä‰º†ÂäüËÉΩ
      uploadLabel.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadLabel.style.backgroundColor = '#e6d7ff';
      });

      uploadLabel.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadLabel.style.backgroundColor = '#f9f7ff';
      });

      uploadLabel.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadLabel.style.backgroundColor = '#f9f7ff';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          imageUpload.files = e.dataTransfer.files;
          
          const reader = new FileReader();
          reader.onload = function(event) {
            // ‰øùÂ≠òÂΩìÂâçÂõæÁâáË∑ØÂæÑ
            currentImageSrc = event.target.result;
            
            const popupImage = document.getElementById('popupImage');
            const popupContainer = document.getElementById('popup-container');
            
            // ËÆæÁΩÆÂºπÂá∫ÂõæÁâáÁöÑÊ∫ê
            popupImage.src = event.target.result;
            
            // ÈáçÁΩÆÂä®ÁîªÁ±ª
            const card3d = document.querySelector('.card-3d');
            card3d.classList.remove('active');
            
            // Ëß¶ÂèëÈáçÊéí
            void card3d.offsetWidth;
            
            // ÊòæÁ§∫ÂºπÂá∫Â±Ç
             setTimeout(() => {
              popupContainer.classList.add('active');
              
              // Ëá™Âä®‰∏ä‰º†ÂõæÁâá
              uploadImage();
              
              // Âú®ËØÜÂà´ÂÆåÊàêÂêéÂ∞ÜÂõæÁâáÊòæÁ§∫Âú®.selected-image-container‰∏≠
              setTimeout(() => {
                document.getElementById('uploadArea').style.display = 'none';
                const selectedImageArea = document.getElementById('selectedImageArea');
                selectedImageArea.style.display = 'block';
                document.getElementById('selectedImagePreview').src = currentImageSrc;
                // ÈöêËóèÈÄâÈ°πÊ†è
                const optionsContainer = document.querySelector('.options');
                if (optionsContainer) {
                  optionsContainer.classList.remove('show');
                }
              }, 1000); // Á≠âÂæÖ‰∏ä‰º†ÂíåËØÜÂà´ÂÆåÊàêÂêéÂÜçÊòæÁ§∫
            }, 10);
          }
          reader.readAsDataURL(file);
        }
      });



      // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      window.showLoading = function() {
        loading.style.display = 'block';
        // ÁßªÈô§ÊñáÊú¨ÊèêÁ§∫ÔºåÂè™‰øùÁïôÂä®ÁîªÊïàÊûú
        const loadingText = document.querySelector('#loading p');
        if(loadingText) loadingText.textContent = '';
        errorMessage.style.display = 'none';
        resultSection.style.display = 'none';
      };

      // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
      window.hideLoading = function() {
        // Ê∑ªÂä†Ê∑°Âá∫Âä®ÁîªÊïàÊûú
        const loadingElement = document.getElementById('loading');
        loadingElement.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        loadingElement.style.opacity = '0';
        loadingElement.style.transform = 'translateY(-10px)';
        
        // Á≠âÂæÖÂä®ÁîªÂÆåÊàêÂêéÂÆåÂÖ®ÈöêËóè
        setTimeout(() => {
          loadingElement.style.display = 'none';
          loadingElement.style.opacity = '1';
          loadingElement.style.transform = 'translateY(0)';
        }, 500);
      };

      // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
      window.showError = function(message) {
        const notification = document.getElementById('notification');
        const notificationText = notification.querySelector('.notification-text');
        const notificationIcon = notification.querySelector('.notification-icon');
        
        notificationText.textContent = message;
        notificationIcon.textContent = '‚ùå';
        notification.style.background = 'linear-gradient(135deg, #ff4757, #ff6b81)';
        notification.classList.add('show');
        
        // Êí≠ÊîæÈîôËØØÈÄöÁü•Èü≥Êïà
        window.playErrorSound();
        
        // 3ÁßíÂêéËá™Âä®ÈöêËóè
        setTimeout(() => {
          notification.classList.remove('show');
          // ÊÅ¢Â§çÈªòËÆ§Ê†∑Âºè
          setTimeout(() => {
            notificationIcon.textContent = '‚úÖ';
            notification.style.background = 'linear-gradient(135deg, #ff69b4, #ff85c0)';
          }, 500);
        }, 3000);
      };

      // ÊòæÁ§∫ÈÄöÁü•
      window.showNotification = function(message) {
        const notification = document.getElementById('notification');
        const notificationText = notification.querySelector('.notification-text');
        
        notificationText.textContent = message;
        notification.classList.add('show');
        
        // Êí≠ÊîæÈÄöÁü•Èü≥Êïà
        window.playNotificationSound();
        
        // 3ÁßíÂêéËá™Âä®ÈöêËóè
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      };
      
      // Êí≠ÊîæÈÄöÁü•Èü≥Êïà
      window.playNotificationSound = function() {
        try {
          // ÂàõÔøΩÔøΩÈü≥È¢ë‰∏ä‰∏ãÊñá
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          
          // ÂàõÂª∫ oscillator ËäÇÁÇπ
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          // ËøûÊé•ËäÇÁÇπ
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          // ËÆæÁΩÆÂèÇÊï∞
          oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
          oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.3);
          
          gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
          
          // ÂºÄÂßãÊí≠Êîæ
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.3);
        } catch (error) {
          console.log('Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•:', error);
        }
      };
      
      // Êí≠ÊîæÈîôËØØÈÄöÁü•Èü≥Êïà
      window.playErrorSound = function() {
        try {
          // ÂàõÂª∫Èü≥È¢ë‰∏ä‰∏ãÊñá
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          
          // ÂàõÂª∫ oscillator ËäÇÁÇπ
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          // ËøûÊé•ËäÇÁÇπ
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          // ËÆæÁΩÆÂèÇÊï∞ - ÈîôËØØÈü≥ÊïàÔºöÊõ¥‰ΩéÁöÑÈ¢ëÁéáÔºåÊõ¥Áü≠ÁöÑÊåÅÁª≠Êó∂Èó¥ÔºåÊõ¥Âà∫ËÄ≥ÁöÑÂ£∞Èü≥
          oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
          oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.2);
          oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.4);
          
          gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
          
          // ÂºÄÂßãÊí≠Êîæ
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.4);
        } catch (error) {
          console.log('Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•:', error);
        }
      };
      
      // ÊòæÁ§∫ËØÜÂà´ÁªìÊûú
      window.displayResults = function(data) {
        console.log('APIËøîÂõûÁöÑÊï∞ÊçÆ:', data); // Ë∞ÉËØï‰ø°ÊÅØ
        
        resultGrid.innerHTML = '';
        
        // ÈÄÇÈÖçÊñ∞ÁöÑÊï∞ÊçÆÁªìÊûÑÔºö‰ªé data.data ËÄå‰∏çÊòØ data.faces Ëé∑ÂèñÊï∞ÊçÆ
        const faceDataArray = data.data || data.faces;
        
        if (faceDataArray && faceDataArray.length > 0) {
          // ‰øùÂ≠òÂÆåÊï¥ÁöÑ‰∫∫ËÑ∏Êï∞ÊçÆÁî®‰∫éÂêéÁª≠ÊòæÁ§∫
          window.faceData = faceDataArray;
          
          // ÊòæÁ§∫ËØÜÂà´ÊàêÂäüÈÄöÁü•
          const faceCount = faceDataArray.length;
          showNotification(`ËØÜÂà´ÊàêÂäüÔºåÂÖ±ËØÜÂà´Âá∫ ${faceCount} ‰∏™ËßíËâ≤`);
          
          // ÂÆö‰πâemojiÊï∞ÁªÑ
          const emojis = ['üò∫', 'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ', 'üê±', 'üéâ', '‚ú®', 'üíñ', 'üéä', 'üåü', 'üí´', 'üå∏', 'üçÄ', 'üéµ', 'üåà'];
          
          /**
           * Êâì‰π±Êï∞ÁªÑÁöÑÈ°∫Â∫èÔºàFisher-YatesÊ¥óÁâåÁÆóÊ≥ïÔºâ
           * 
           * @param {Array} array - Ë¶ÅÊâì‰π±ÁöÑÊï∞ÁªÑ
           * @returns {Array} Êâì‰π±ÂêéÁöÑÊï∞ÁªÑ
           * 
           * @description
           * ËØ•ÂáΩÊï∞‰ΩøÁî®Fisher-YatesÊ¥óÁâåÁÆóÊ≥ïÈöèÊú∫Êâì‰π±Êï∞ÁªÑÁöÑÈ°∫Â∫è
           */
          function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
          }
          
          // Êâì‰π±emojiÊï∞ÁªÑÔºåÁ°Æ‰øùÊØè‰∏™Âç°Áâá‰ΩøÁî®‰∏çÂêåÁöÑemoji
          const shuffledEmojis = shuffleArray(emojis);
          
          faceDataArray.forEach((face, index) => {
            console.log(`‰∫∫ËÑ∏ ${index} ÁöÑÊï∞ÊçÆ:`, face); // Ë∞ÉËØï‰ø°ÊÅØ
            
            const card = document.createElement('div');
            card.className = 'result-card';
            // ÂàùÂßãËÆæÁΩÆÂç°Áâá‰∏∫‰∏çÂèØËßÅÁä∂ÊÄÅ
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            
            // Â≠òÂÇ®‰∫∫ËÑ∏Á¥¢ÂºïÂà∞Âç°Áâá‰∏äÔºå‰ª•‰æøËÆøÈóÆÂÆåÊï¥Êï∞ÊçÆ
            card.dataset.faceIndex = index;
            
            // ÈÄÇÈÖçÊñ∞ÁöÑÊï∞ÊçÆÁªìÊûÑÔºåËß£ÊûêËßíËâ≤Âíå‰ΩúÂìÅ‰ø°ÊÅØ
            // Êñ∞APIÊ†ºÂºèÔºöcharacterÊï∞ÁªÑÂåÖÂê´ { work, character }
            let mainCharacter = 'Êú™Áü•ËßíËâ≤';
            let mainAnime = 'Êú™Áü•';
            let candidates = [];
            
            if (face.character && face.character.length > 0) {
              // Á¨¨‰∏Ä‰∏™ÊòØ‰∏ªË¶ÅËßíËâ≤
              if (face.character[0]) {
                mainCharacter = face.character[0].character || 'Êú™Áü•ËßíËâ≤';
                mainAnime = face.character[0].work || 'Êú™Áü•';
              }
              // ÂÖ∂‰Ωô‰Ωú‰∏∫ÂÄôÈÄâ
              candidates = face.character.slice(1).map(c => ({
                name: c.character,
                anime: c.work,
                score: 0.8 - (0.05 * index) // Ê®°ÊãüÁΩÆ‰ø°Â∫¶
              }));
            } else if (face.name) {
              // ÊóßÊ†ºÂºèÂÖºÂÆπ
              mainCharacter = face.name;
              mainAnime = face.anime || 'Êú™Áü•';
              candidates = face.top_k || [];
            }
            
            // ‰ªéÊâì‰π±ÂêéÁöÑemojiÊï∞ÁªÑ‰∏≠ÊåâÈ°∫Â∫èÂèñemojiÔºåÂ¶ÇÊûú‰∫∫ËÑ∏Êï∞ÈáèË∂ÖËøáemojiÊï∞ÈáèÂàôÂæ™ÁéØ‰ΩøÁî®
            const emojiIndex = index % shuffledEmojis.length;
            const currentEmoji = shuffledEmojis[emojiIndex];
            card.innerHTML = `
              <div class="result-top">
                <div class="result-icon">${currentEmoji}</div>
              </div>
              <div class="result-info">
                <div class="result-name" ${(mainCharacter && mainCharacter !== 'Êú™Áü•ËßíËâ≤') ? `onclick="searchCharacter('${mainCharacter}', '${mainAnime || ''}')"` : ''}>${mainCharacter}</div>
                <div class="result-anime" ${(mainAnime && mainAnime !== 'Êú™Áü•') ? `onclick="searchBangumi('${mainAnime}')"` : ''}>‰ΩúÂìÅ: ${mainAnime}</div>
                <div class="result-score">ÁΩÆ‰ø°Â∫¶: ${(0.85).toFixed(2)}%</div>
                <div class="confidence-bar-container">
                  <div class="confidence-bar">
                    <div class="confidence-bar-fill" style="--confidence-percent: ${(85).toFixed(2)}%"></div>
                  </div>
                </div>
                <div class="result-details-toggle">
                  <button class="toggle-btn">Â±ïÂºÄËØ¶ÊÉÖ</button>
                </div>
                <div class="result-details-hidden">
                  ÂÄôÈÄâÁªìÊûú:
                  <div class="candidate-results">
                    ${(candidates.length > 0) ? candidates.map((candidate, idx) => 
                      `<div class="candidate-item">
                        <div class="candidate-info">
                          <span class="candidate-name" ${(candidate.name && candidate.name !== 'Êú™Áü•ËßíËâ≤') ? `onclick="searchCharacter('${candidate.name}', '${candidate.anime || ''}')"` : ''}>${candidate.name}</span>
                          <span class="candidate-anime" ${(candidate.anime && candidate.anime !== 'Êú™Áü•') ? `onclick="searchBangumi('${candidate.anime}')"` : ''}>‰ΩúÂìÅ: ${candidate.anime || 'Êú™Áü•'}</span>
                          <span class="candidate-score">ÁΩÆ‰ø°Â∫¶: ${((0.8 - (0.03 * idx)) * 100).toFixed(2)}%</span>
                        </div>
                      </div>`).join('') : 'Êó†ÂÄôÈÄâÁªìÊûú'}
                  </div>
                </div>
              </div>
            `;
            
            // Ê∑ªÂä†Èº†Ê†áËøõÂÖ•‰∫ã‰ª∂ - ÁªìÂêàÊòæÁ§∫‰∫∫ËÑ∏Ê°ÜÈÄâÂíå3DÊïàÊûú
            card.addEventListener('mouseenter', function() {
              // ÊòæÁ§∫3DÂºπÂá∫ÂõæÁâáÂπ∂È´ò‰∫ÆÂØπÂ∫î‰∫∫Áâ©
              const faceIndex = parseInt(this.dataset.faceIndex);
              showPopupWithFaceHighlight(window.faceData[faceIndex]);
              this.style.transition = 'none'; // ÁßªÈô§ËøáÊ∏°ÊïàÊûú‰ª•Ëé∑ÂæóÊõ¥ÊµÅÁïÖÁöÑÈº†Ê†áË∑üÈöè
            });
            
            // Ê∑ªÂä†Èº†Ê†áÁßªÂä®‰∫ã‰ª∂ÂÆûÁé∞3DÊïàÊûú
            card.addEventListener('mousemove', function(e) {
              const cardRect = this.getBoundingClientRect();
              const x = e.clientX - cardRect.left;
              const y = e.clientY - cardRect.top;
              
              const centerX = cardRect.width / 2;
              const centerY = cardRect.height / 2;
              
              const rotateY = (x - centerX) / 25; // ÊéßÂà∂Ê∞¥Âπ≥ÊóãËΩ¨
              const rotateX = (centerY - y) / 25; // ÊéßÂà∂ÂûÇÁõ¥ÊóãËΩ¨
              const scale = 1.05; // Âü∫Á°ÄÁº©Êîæ
                
              this.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(${scale})`;
            });
            
            // Ê∑ªÂä†Èº†Ê†áÁ¶ªÂºÄ‰∫ã‰ª∂
            card.addEventListener('mouseleave', function() {
              this.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; // ÊÅ¢Â§çËøáÊ∏°ÊïàÊûú
              this.style.transform = 'translateY(-8px) scale(1)';
              removeFaceHighlight(); // ÁßªÈô§‰∫∫ËÑ∏Ê°ÜÈÄâ
            });
            
            // Ê∑ªÂä†Â±ïÂºÄ/ÊäòÂè†ÂäüËÉΩ
            const toggleBtn = card.querySelector('.toggle-btn');
            const detailsHidden = card.querySelector('.result-details-hidden');
            
            if (toggleBtn && detailsHidden) {
              toggleBtn.addEventListener('click', function() {
                if (detailsHidden.classList.contains('expanded')) {
                  // Êî∂Ëµ∑ËØ¶ÊÉÖ
                  detailsHidden.classList.remove('expanded');
                  toggleBtn.textContent = 'Â±ïÂºÄËØ¶ÊÉÖ';
                } else {
                  // Â±ïÂºÄËØ¶ÊÉÖ
                  detailsHidden.classList.add('expanded');
                  toggleBtn.textContent = 'Êî∂Ëµ∑ËØ¶ÊÉÖ';
                }
              });
            }
            
            resultGrid.appendChild(card);
          });
          
          // ÊòæÁ§∫ÁªìÊûúÂå∫Âüü
          resultSection.style.display = 'block';
          resultSection.style.opacity = '0';
          resultSection.style.transform = 'translateY(20px)';
          
          // Âº∫Âà∂ÈáçÊéí‰ª•Á°Æ‰øùÂä®ÁîªÊïàÊûú
          resultSection.offsetHeight;
          
          // Ê∑ªÂä†Ê∑°ÂÖ•Âä®Áîª
          setTimeout(() => {
            resultSection.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            resultSection.style.opacity = '1';
            resultSection.style.transform = 'translateY(0)';
            
            // ‰∏∫ÊØè‰∏™Âç°ÁâáÊ∑ªÂä†ËøõÂÖ•Âä®Áîª
            const cards = resultGrid.querySelectorAll('.result-card');
            cards.forEach((card, index) => {
              setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
              }, 100 * index); // ‰æùÊ¨°Âª∂ËøüÊòæÁ§∫ÊØè‰∏™Âç°Áâá
            });
          }, 50);
          
        } else {
          errorMessage.textContent = 'Êú™ËØÜÂà´Âà∞‰ªª‰ΩïÂä®Êº´ËßíËâ≤';
          errorMessage.style.display = 'block';
          errorMessage.style.opacity = '0';
          errorMessage.style.transform = 'translateY(20px)';
          errorMessage.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          
          // Âº∫Âà∂ÈáçÊéí‰ª•Á°Æ‰øùÂä®ÁîªÊïàÊûú
          errorMessage.offsetHeight;
          
          // Ê∑ªÂä†Ê∑°ÂÖ•Âä®Áîª
          setTimeout(() => {
            errorMessage.style.opacity = '1';
            errorMessage.style.transform = 'translateY(0)';
          }, 50);
        }
      }
    });
    
    // ÁÇπÂáªÂºπÂá∫Â±ÇËÉåÊôØÂÖ≥Èó≠ÂºπÂá∫
    document.getElementById('popup-container').addEventListener('click', function(e) {
      if (e.target === this) {
        this.classList.remove('active');
        
        // Â∞ÜÈÄâÊã©ÂõæÁâáÁöÑÂå∫ÂüüÊõøÊç¢‰∏∫Â∑≤ÈÄâÊã©ÁöÑÂõæÁâá
        if (currentImageSrc) {
          document.getElementById('uploadArea').style.display = 'none';
          const selectedImageArea = document.getElementById('selectedImageArea');
          selectedImageArea.style.display = 'block';
          document.getElementById('selectedImagePreview').src = currentImageSrc;
        }
      }
    });
    
    // Ê∑ªÂä†Èº†Ê†áÁßªÂä®‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºåÂêåÊó∂ÂÆûÁé∞3DÂç°ÁâáË∑üÈöèÈº†Ê†áÂèòÊç¢ÊïàÊûúÂíåÈ´òÂÖâÊïàÊûú
    const card3d = document.querySelector('.card-3d');
    const movingHighlight = document.querySelector('.moving-highlight');
    
    if (card3d) {
      // ‰øùÂ≠òÂéüÂßãÂä®ÁîªÁä∂ÊÄÅ
      let isAnimating = true;
      
      // ÁõëÂê¨Âä®ÁîªÁªìÊùü‰∫ã‰ª∂
      card3d.addEventListener('animationend', () => {
        isAnimating = false; // Âä®ÁîªÁªìÊùüÂêéÂêØÁî®Èº†Ê†á‰∫§‰∫í
      });
      
      card3d.addEventListener('mousemove', (e) => {
        if (isAnimating) return; // Â¶ÇÊûúËøòÂú®ÊâßË°åÂàùÂßãÂä®ÁîªÔºåÂàô‰∏çÂ§ÑÁêÜÈº†Ê†áÁßªÂä®‰∫ã‰ª∂
        
        const card = e.currentTarget;
        const rect = card.getBoundingClientRect();
        
        // ËÆ°ÁÆóÈº†Ê†áÂú®Âç°Áâá‰∏äÁöÑÁõ∏ÂØπ‰ΩçÁΩÆ (0-1)
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        // ËÆ°ÁÆó‰∏≠ÂøÉÁÇπ
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        // ËÆ°ÁÆóÂÅèÁßªÈáè (-1 Âà∞ 1)
        const moveX = (x - centerX) / centerX;
        const moveY = (y - centerY) / centerY;
        
        // Â∫îÁî®3DÂèòÊç¢
        card.style.transform = `perspective(1500px) rotateY(${moveX * 10}deg) rotateX(${moveY * -10}deg) translateZ(30px)`;
        
        // Êõ¥Êñ∞È´òÂÖâ‰ΩçÁΩÆ
        if (movingHighlight) {
          const highlightX = ((e.clientX - rect.left) / rect.width) * 100;
          const highlightY = ((e.clientY - rect.top) / rect.height) * 100;
          
          movingHighlight.style.setProperty('--mouse-x', highlightX + '%');
          movingHighlight.style.setProperty('--mouse-y', highlightY + '%');
        }
      });
      
      // Èº†Ê†áÁ¶ªÂºÄÊó∂ÊÅ¢Â§çÂéüÂßãÁä∂ÊÄÅÔºåÊ∑ªÂä†Âä®ÁîªÊïàÊûú
      card3d.addEventListener('mouseleave', (e) => {
        if (!isAnimating) {
          // ‰ΩøÁî®Êõ¥Âπ≥ÊªëÁöÑËøáÊ∏°Âä®Áîª
          e.currentTarget.style.transition = 'transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
          e.currentTarget.style.transform = `perspective(1500px) rotateY(0) rotateX(0) translateZ(0)`;
          
          // Âú®Âä®ÁîªÁªìÊùüÂêéÊÅ¢Â§çÈªòËÆ§ËøáÊ∏°ËÆæÁΩÆ
          setTimeout(() => {
            e.currentTarget.style.transition = 'transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
          }, 400);
        }
        
        // ÈöêËóèÈ´òÂÖâ
        if (movingHighlight) {
          movingHighlight.style.opacity = '0';
        }
      });
      
      // Èº†Ê†áËøõÂÖ•Êó∂ÊòæÁ§∫È´òÂÖâ
      card3d.addEventListener('mouseenter', (e) => {
        if (movingHighlight) {
          movingHighlight.style.opacity = '0.6';
        }
      });
    }
    
    // Ê∑ªÂä†ESCÈîÆÂÖ≥Èó≠ÂºπÂá∫Â±ÇÁöÑÂäüËÉΩ
  document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.getElementById('popup-container').classList.remove('active');
        
        // Â∞ÜÈÄâÊã©ÂõæÁâáÁöÑÂå∫ÂüüÊõøÊç¢‰∏∫Â∑≤ÈÄâÊã©ÁöÑÂõæÁâá
        if (currentImageSrc) {
          document.getElementById('uploadArea').style.display = 'none';
          const selectedImageArea = document.getElementById('selectedImageArea');
          selectedImageArea.style.display = 'block';
          document.getElementById('selectedImagePreview').src = currentImageSrc;
        }
      }
    });
    
    /**
     * ÁßªÈô§È´ò‰∫ÆÊòæÁ§∫
     * 
     * @returns {void}
     * 
     * @description
     * ËØ•ÂáΩÊï∞ÁßªÈô§ÂΩìÂâçÁöÑÈ´ò‰∫ÆÊòæÁ§∫ÊïàÊûú
     */
    function removeFaceHighlight() {
      // ÁßªÈô§È´ò‰∫ÆÊ°Ü
      const highlightBox = document.getElementById('face-highlight-box');
      if (highlightBox) {
        highlightBox.remove();
      }
    }
    
    /**
     * Âú®ÂéüÂõæ‰∏äÈ´ò‰∫ÆÊòæÁ§∫‰∫∫ËÑ∏‰ΩçÁΩÆÔºå‰ΩøÁî®ÈÄêÊ∏êÈÄºËøëÁöÑÊñπÊ°ÜÊïàÊûú
     * 
     * @param {Object} faceData - ‰∫∫ËÑ∏Êï∞ÊçÆÂØπË±°
     * @returns {void}
     * 
     * @description
     * ËØ•ÂáΩÊï∞Âú®ÂéüÂõæ‰∏äÁªòÂà∂‰∏Ä‰∏™ÈÄêÊ∏êÈÄºËøëÁöÑÊñπÊ°ÜÊù•È´ò‰∫ÆÊòæÁ§∫‰∫∫ËÑ∏‰ΩçÁΩÆ
     * 
     * @throws {Error} ÂΩìÂèÇÊï∞Êó†ÊïàÊó∂ÂèØËÉΩÊäõÂá∫ÈîôËØØ
     */
    function showPopupWithFaceHighlight(faceData) {
      if (!faceData) return;
      
      try {
        // ‰ªé‰∫∫ËÑ∏Êï∞ÊçÆ‰∏≠Ëé∑ÂèñËæπÁïåÊ°Ü‰ø°ÊÅØ
        let bbox = null;
        if (faceData.bounding_box) {
          bbox = faceData.bounding_box;  // ‰ΩøÁî®APIËøîÂõûÁöÑÊùÉÂ®Å‰∫∫ËÑ∏Ê°ÜÂùêÊ†á
        } else if (faceData.bbox) {
          bbox = faceData.bbox;
        } else if (faceData.location) {
          bbox = faceData.location;
        } else if (faceData.box) {
          bbox = faceData.box;
        } else if (faceData.rect) {
          bbox = faceData.rect;
        } else {
          // Â∞ùËØïÊü•ÊâæÂåÖÂê´ÂùêÊ†á‰ø°ÊÅØÁöÑÂ≠óÊÆµ
          const possibleFields = Object.keys(faceData).filter(key => 
            key.toLowerCase().includes('box') || 
            key.toLowerCase().includes('rect') || 
            key.toLowerCase().includes('location')
          );
          
          if (possibleFields.length > 0) {
            bbox = faceData[possibleFields[0]];
          }
        }
        
        if (!bbox) {
          console.warn('Êú™ÊâæÂà∞‰∫∫ËÑ∏ËæπÁïåÊ°Ü‰ø°ÊÅØ');
          return;
        }
        
        // ËÆ°ÁÆóËæπÁïåÊ°ÜÂùêÊ†á - ‰øùÂ≠òÂéüÂßãÂÄº
        let x1, y1, x2, y2;
        let isRelativeCoordinate = false;
        
        if (Array.isArray(bbox)) {
          if (bbox.length === 4) {
            // Â§ÑÁêÜ [x1, y1, x2, y2] Ê†ºÂºè
            [x1, y1, x2, y2] = bbox;
            
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÁõ∏ÂØπÂùêÊ†áÔºàÂÄºÂú®0-1‰πãÈó¥Ôºâ
            isRelativeCoordinate = (x1 >= 0 && x1 <= 1 && y1 >= 0 && y1 <= 1 && 
                                   x2 >= 0 && x2 <= 1 && y2 >= 0 && y2 <= 1);
          } else {
            console.warn('ËæπÁïåÊ°ÜÊï∞ÁªÑÊ†ºÂºè‰∏çÊ≠£Á°Æ');
            return;
          }
        } else if (typeof bbox === 'object') {
          if (bbox.x !== undefined && bbox.y !== undefined && 
              bbox.width !== undefined && bbox.height !== undefined) {
            x1 = bbox.x;
            y1 = bbox.y;
            x2 = bbox.x + bbox.width;
            y2 = bbox.y + bbox.height;
          } 
          // ÊàñËÄÖ {left, top, right, bottom} Ê†ºÂºè
          else if (bbox.left !== undefined && bbox.top !== undefined && 
                   bbox.right !== undefined && bbox.bottom !== undefined) {
            x1 = bbox.left;
            y1 = bbox.top;
            x2 = bbox.right;
            y2 = bbox.bottom;
          } else {
            console.warn('ËæπÁïåÊ°ÜÂØπË±°Ê†ºÂºè‰∏çÊ≠£Á°Æ');
            return;
          }
        } else {
          console.warn('ËæπÁïåÊ°ÜÊï∞ÊçÆÊ†ºÂºè‰∏çÊîØÊåÅ');
          return;
        }
        
        // Ëé∑ÂèñÂéüÂõæÂÖÉÁ¥†ÂíåoverlayÂÖÉÁ¥†
        const originalImage = document.querySelector('.selected-image');
        if (!originalImage) {
          console.warn('Êú™ÊâæÂà∞ÂéüÂõæÂÖÉÁ¥†');
          return;
        }
        
        // Ëé∑ÂèñÂõæÁâáÂÆπÂô®ÂÖÉÁ¥†
        const imageContainer = document.querySelector('.selected-image-container');
        if (!imageContainer) {
          console.warn('Êú™ÊâæÂà∞ÂõæÁâáÂÆπÂô®ÂÖÉÁ¥†');
          return;
        }
        
        // Ëé∑Âèñface-overlayÂÖÉÁ¥†
        const faceOverlay = document.getElementById('face-overlay');
        if (!faceOverlay) {
          console.warn('Êú™ÊâæÂà∞face-overlayÂÖÉÁ¥†');
          return;
        }
        
        // Ê∏ÖÈô§‰πãÂâçÂèØËÉΩÂ≠òÂú®ÁöÑÊ°Ü
        faceOverlay.innerHTML = '';
        
        // ÁîüÊàêÈöèÊú∫È¢úËâ≤
        const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
        
        // ÂàõÂª∫‰∏Ä‰∏™divÂÖÉÁ¥†‰Ωú‰∏∫È´ò‰∫ÆÊ°Ü
        const highlightBox = document.createElement('div');
        highlightBox.id = 'face-highlight-box';
        highlightBox.style.position = 'absolute';
        highlightBox.style.border = '2px solid ' + randomColor;
        highlightBox.style.backgroundColor = 'transparent';
        highlightBox.style.pointerEvents = 'none';
        highlightBox.style.zIndex = '100';
        highlightBox.style.opacity = '0.8';
        highlightBox.style.boxShadow = `0 0 10px ${randomColor}aa`; // Ê∑ªÂä†ÈÄèÊòéÂ∫¶
        
        // ËÆ°ÁÆóÁõ∏ÂØπ‰∫éÂõæÁâáÂÆπÂô®ÁöÑÂùêÊ†á
        const containerRect = imageContainer.getBoundingClientRect();
        const imageRect = originalImage.getBoundingClientRect();
        
        // ÂàùÂßã‰ΩçÁΩÆËÆæ‰∏∫ÂõæÁâá‰∏≠ÂøÉÔºåÁÑ∂ÂêéÈÄêÊ∏êÁßªÂä®Âà∞ÁõÆÊ†á‰ΩçÁΩÆ
        // ‰ªéÂõæÁâáÂÖÉÁ¥†ÁöÑ‰∏≠ÂøÉÂºÄÂßãÔºåËÄå‰∏çÊòØÂÆπÂô®ÁöÑ‰∏≠ÂøÉ
        const centerX = (imageRect.left - containerRect.left) + imageRect.width / 2;
        const centerY = (imageRect.top - containerRect.top) + imageRect.height / 2;
        const centerWidth = 20;
        const centerHeight = 20;
        
        // ËÆæÁΩÆÂàùÂßã‰ΩçÁΩÆÂíåÂ∞∫ÂØ∏
        highlightBox.style.left = `${centerX - centerWidth / 2}px`;
        highlightBox.style.top = `${centerY - centerHeight / 2}px`;
        highlightBox.style.width = `${centerWidth}px`;
        highlightBox.style.height = `${centerHeight}px`;
        
        // Ê∑ªÂä†Âà∞overlay
        faceOverlay.appendChild(highlightBox);
        
        // ‰ΩøÁî®requestAnimationFrameÂÆûÁé∞ÈÄêÊ∏êÈÄºËøëÁöÑÊïàÊûú
        const startTime = performance.now();
        const duration = 500; // Âä®ÁîªÊåÅÁª≠Êó∂Èó¥500ms
        
        // ËÆ°ÁÆóÂõæÁâáÁöÑÁº©ÊîæÊØî‰æãÂíåÂÅèÁßª
        const naturalWidth = originalImage.naturalWidth || originalImage.width;
        const naturalHeight = originalImage.naturalHeight || originalImage.height;
        const displayWidth = originalImage.clientWidth;
        const displayHeight = originalImage.clientHeight;
        
        // Ê†πÊçÆobject-fit: containËÆ°ÁÆóÂÆûÈôÖÊòæÁ§∫ÁöÑÂõæÁâáÂ∞∫ÂØ∏ÂíåÂÅèÁßª
        const scale = Math.min(displayWidth / naturalWidth, displayHeight / naturalHeight);
        const actualWidth = naturalWidth * scale;
        const actualHeight = naturalHeight * scale;
        const offsetX = (displayWidth - actualWidth) / 2;
        const offsetY = (displayHeight - actualHeight) / 2;
        
        // Âä®ÁîªÂáΩÊï∞
        function animateBox(timestamp) {
          const elapsed = timestamp - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // ‰ΩøÁî®ÁºìÂä®ÂáΩÊï∞‰ΩøÂä®ÁîªÊõ¥Ëá™ÁÑ∂
          const easeProgress = 1 - Math.pow(1 - progress, 3);
          
          // ËÆ°ÁÆóÂΩìÂâçÁöÑ‰ΩçÁΩÆÂíåÂ∞∫ÂØ∏
          let scaledX1, scaledY1, scaledX2, scaledY2;
          
          if (isRelativeCoordinate) {
            // Â¶ÇÊûúÊòØÁõ∏ÂØπÂùêÊ†áÔºåÁõ¥Êé•‰πò‰ª•ÂÆûÈôÖÊòæÁ§∫Â∞∫ÂØ∏
            scaledX1 = x1 * actualWidth + offsetX;
            scaledY1 = y1 * actualHeight + offsetY;
            scaledX2 = x2 * actualWidth + offsetX;
            scaledY2 = y2 * actualHeight + offsetY;
          } else {
            // Âê¶Âàô‰ΩøÁî®ÁªùÂØπÂùêÊ†áÔºåÊåâÂõæÁâáÊØî‰æãÁº©Êîæ
            scaledX1 = x1 * scale + offsetX;
            scaledY1 = y1 * scale + offsetY;
            scaledX2 = x2 * scale + offsetX;
            scaledY2 = y2 * scale + offsetY;
          }
          
          // ËÆ°ÁÆóÊúÄÁªàÁöÑÁõÆÊ†á‰ΩçÁΩÆÂíåÂ∞∫ÂØ∏
          const targetX = scaledX1;
          const targetY = scaledY1;
          const targetWidth = scaledX2 - scaledX1;
          const targetHeight = scaledY2 - scaledY1;
          
          // ËÆ°ÁÆó‰ªé‰∏≠ÂøÉÁÇπÈÄêÊ∏êÁßªÂä®Âà∞ÁõÆÊ†á‰ΩçÁΩÆÁöÑÂùêÊ†á
          // ÈúÄË¶ÅËÄÉËôëÂõæÁâáÂú®ÂÆπÂô®‰∏≠ÁöÑÂÆûÈôÖ‰ΩçÁΩÆ
          const imageRect = originalImage.getBoundingClientRect();
          const containerRect = imageContainer.getBoundingClientRect();
          
          // Â∞ÜÂõæÁâá‰∏äÁöÑÂùêÊ†áËΩ¨Êç¢‰∏∫Áõ∏ÂØπ‰∫éÂÆπÂô®ÁöÑÂùêÊ†á
          const finalTargetX = (imageRect.left - containerRect.left) + targetX;
          const finalTargetY = (imageRect.top - containerRect.top) + targetY;
          
          const currentX = centerX + (finalTargetX - centerX) * easeProgress;
          const currentY = centerY + (finalTargetY - centerY) * easeProgress;
          const currentWidth = centerWidth + (targetWidth - centerWidth) * easeProgress;
          const currentHeight = centerHeight + (targetHeight - centerHeight) * easeProgress;
          
          // Êõ¥Êñ∞Ê†∑Âºè
          highlightBox.style.left = `${currentX}px`;
          highlightBox.style.top = `${currentY}px`;
          highlightBox.style.width = `${currentWidth}px`;
          highlightBox.style.height = `${currentHeight}px`;
          
          if (progress < 1) {
            requestAnimationFrame(animateBox);
          }
        }
        
        // ÂºÄÂßãÂä®Áîª
        requestAnimationFrame(animateBox);
        
      } catch (error) {
        console.error('È´ò‰∫ÆÊòæÁ§∫‰∫∫ËÑ∏Êó∂Âá∫Èîô:', error);
      }
    }
    
  // ‰øùÂ≠òÂΩìÂâçÊòæÁ§∫ÁöÑÂõæÁâá
  let currentImageSrc = '';
  
  /**
   * ÊêúÁ¥¢Âä®Êº´‰ΩúÂìÅ
   * 
   * @param {string} animeName - Ë¶ÅÊêúÁ¥¢ÁöÑÂä®Êº´‰ΩúÂìÅÂêçÁß∞
   * @returns {void}
   * 
   * @description
   * ËØ•ÂáΩÊï∞Âú®Êñ∞Ê†áÁ≠æÈ°µ‰∏≠ÊâìÂºÄÊêúÁ¥¢ÁªìÊûúÈ°µÈù¢Ôºå‰ΩøÁî®ÂøÖÂ∫îÊêúÁ¥¢Âä®Êº´‰ΩúÂìÅ
   */
  function searchAnime(animeName) {
    if (animeName && animeName !== 'Êú™Áü•') {
      // ‰ΩøÁî®ÂøÖÂ∫îÊêúÁ¥¢Âä®Êº´‰ΩúÂìÅ
      const searchUrl = `https://www.bing.com/search?q=${encodeURIComponent(animeName + ' Âä®Êº´')}`;
      window.open(searchUrl, '_blank');
    } else {
      alert('‰ΩúÂìÅÂêçÁß∞Êú™Áü•ÔºåÊó†Ê≥ïÊêúÁ¥¢');
    }
  }
  
  /**
 * ÊêúÁ¥¢Âä®Êº´ËßíËâ≤
 * 
 * @param {string} characterName - Ë¶ÅÊêúÁ¥¢ÁöÑÂä®Êº´ËßíËâ≤ÂêçÁß∞
 * @param {string} animeName - ËßíËâ≤ÊâÄÂ±ûÁöÑÂä®Êº´‰ΩúÂìÅÂêçÁß∞
 * @returns {void}
 * 
 * @description
 * ËØ•ÂáΩÊï∞Âú®Êñ∞Ê†áÁ≠æÈ°µ‰∏≠ÊâìÂºÄÊêúÁ¥¢ÁªìÊûúÈ°µÈù¢Ôºå‰ΩøÁî®BangumiÁöÑmono_searchÊé•Âè£ÊêúÁ¥¢Âä®Êº´ËßíËâ≤
 */
function searchCharacter(characterName, animeName) {
  if (characterName && characterName !== 'Êú™Áü•ËßíËâ≤') {
    // ‰ΩøÁî®BangumiÁöÑmono_searchÊé•Âè£ÊêúÁ¥¢ËßíËâ≤
    const searchUrl = `https://bgm.tv/mono_search/${encodeURIComponent(characterName)}?cat=all`;
    window.open(searchUrl, '_blank');
  } else {
    alert('ËßíËâ≤ÂêçÁß∞Êú™Áü•ÔºåÊó†Ê≥ïÊêúÁ¥¢');
  }
}
  
  /**
   * ÊêúÁ¥¢BangumiÊù°ÁõÆ
   * 
   * @param {string} query - ÊêúÁ¥¢ÂÖ≥ÈîÆËØç
   * @returns {void}
   * 
   * @description
   * ËØ•ÂáΩÊï∞Âú®Êñ∞Ê†áÁ≠æÈ°µ‰∏≠ÊâìÂºÄBangumiÊêúÁ¥¢ÁªìÊûúÈ°µÈù¢
   */
  function searchBangumi(query) {
    if (query && query !== 'Êú™Áü•' && query !== 'Êú™Áü•ËßíËâ≤') {
      const searchUrl = `https://bgm.tv/subject_search/${encodeURIComponent(query)}`;
      window.open(searchUrl, '_blank');
    } else {
      alert('ÊêúÁ¥¢ËØçÊú™Áü•ÔºåÊó†Ê≥ïÊêúÁ¥¢');
    }
  }
  
  // ‰øÆÊîπpreviewImageÂáΩÊï∞‰ª•‰øùÂ≠òÂΩìÂâçÂõæÁâá
  function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        // ‰øùÂ≠òÂΩìÂâçÂõæÁâáË∑ØÂæÑ
        currentImageSrc = e.target.result;
        
        // ÊòæÁ§∫3DÂç°ÁâáÂºπÂá∫Â±Ç
        const popupContainer = document.getElementById('popup-container');
        const popupImage = document.getElementById('popupImage');
        
        popupImage.src = e.target.result;
        
        // ÈáçÁΩÆÂä®ÁîªÁ±ª
        const card3d = document.querySelector('.card-3d');
        card3d.classList.remove('active');
        
        // Ëß¶ÂèëÈáçÊéí
        void card3d.offsetWidth;
        
        // ÊòæÁ§∫ÂºπÂá∫Â±Ç
        setTimeout(() => {
          popupContainer.classList.add('active');
        }, 10);
      };
      reader.readAsDataURL(file);
    }
  }
  </script>
</body>
</html>